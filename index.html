<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Brawl Tryouts</title>
    
    <!-- MathJax for rendering Physics Equations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Desmos Graphing Calculator API -->
    <script src="https://www.desmos.com/api/v1.11/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 850px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .section-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: center;
        }
        .section-header h2 {
            color: white !important;
            margin: 0;
        }
        ul {
            margin-top: 0;
        }
        li {
            margin-bottom: 5px;
        }
        .header {
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border: 1px solid #ffeeba;
            border-radius: 5px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .problem {
            background: #fafafa;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin-bottom: 30px;
        }
        .problem.section2 {
            border-left-color: #8e44ad; /* Purple for section 2 */
        }
        .hint {
            font-size: 0.9em;
            color: #666;
            background: #eee;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: inline-block;
            cursor: pointer;
            user-select: none;
            font-weight: 600;
        }
        .hint:hover {
            background: #ddd;
        }
        .hint-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            border: 1px dashed #ccc;
            border-radius: 4px;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #2c3e50;
        }
        input[type="text"], textarea, input[type="email"], input[type="number"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
        }
        textarea {
            height: 80px;
            font-family: monospace;
        }
        button.submit-btn {
            background-color: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s;
            font-weight: bold;
        }
        button.submit-btn:hover {
            background-color: #219150;
        }
        .status-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: #27ae60;
            z-index: 1000;
            transition: background-color 0.3s;
        }
        .cheat-detected {
            background: #e74c3c !important;
        }
        blockquote {
            border-left: 3px solid #ccc;
            margin: 10px 0;
            padding-left: 15px;
            color: #555;
            font-style: italic;
        }
        
        /* WELCOME SCREEN STYLES */
        #welcomeScreen {
            text-align: center;
        }
        .welcome-box {
            border: 2px solid #3498db;
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
        }
        .password-section {
            background: #eee;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .error-msg {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }

        /* --- SECURITY CONSOLE STYLES --- */
        #securityConsole {
            position: fixed;
            left: 10px;
            top: 80px;
            width: 240px;
            background-color: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            border: 2px solid #333;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.6);
            z-index: 1500;
            display: none; /* Hidden until login */
            overflow: hidden;
            /* Transition for minimize effect */
            max-height: 250px; 
            transition: max-height 0.3s ease-in-out;
        }
        /* Minimized State */
        #securityConsole.minimized {
            max-height: 34px; /* Only header visible */
        }
        
        .console-header {
            background-color: #2c3e50;
            color: #fff;
            padding: 8px 10px;
            font-weight: bold;
            border-bottom: 1px solid #555;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer; /* Clickable */
        }
        .console-header:hover {
            background-color: #34495e;
        }
        .console-title-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .console-dot {
            width: 8px;
            height: 8px;
            background-color: #e74c3c;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        .console-toggle-icon {
            font-size: 14px;
            font-weight: bold;
            color: #bdc3c7;
        }

        #consoleOutput {
            height: 200px;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column-reverse; /* Newest at bottom */
        }
        .log-entry {
            margin-bottom: 4px;
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
            line-height: 1.3;
        }
        .log-warn { color: #ff4444; font-weight: bold; }
        .log-ok { color: #00ff00; }
        
        /* Scrollbar for console */
        #consoleOutput::-webkit-scrollbar { width: 6px; }
        #consoleOutput::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }

        /* --- DSAT STYLE CALCULATOR --- */
        /* Floating Action Button */
        #calcToggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 2000;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: #2c3e50;
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            cursor: pointer;
            display: none; /* Hidden until logged in */
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #calcToggle:hover {
            transform: scale(1.1);
            background: #34495e;
        }
        #calcToggle svg {
            width: 32px;
            height: 32px;
            fill: white;
        }

        /* Draggable Container */
        #calculatorPopup {
            position: fixed;
            top: 20%;
            left: 20%;
            z-index: 2100;
            background: white;
            padding: 0;
            border: 1px solid #aaa;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            border-radius: 8px;
            display: none;
            overflow: hidden;
            /* Smooth resize transition */
            transition: width 0.3s ease, height 0.3s ease;
        }

        /* Header Bar (Drag Handle) */
        .calc-header-bar {
            background: #2c3e50; /* Matches DSAT dark theme */
            color: white;
            padding: 10px 15px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            border-bottom: 1px solid #1a252f;
        }
        .calc-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .calc-controls button {
            background: transparent;
            border: none;
            color: #bdc3c7;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }
        .calc-controls button:hover { 
            color: white; 
            background: rgba(255,255,255,0.1);
        }

        /* The Desmos Container */
        #calculator {
            width: 600px;
            height: 400px;
            /* Ensure Desmos fits the container exactly during resize */
            transition: width 0.3s, height 0.3s;
        }
        
        /* Resize State (Theater Mode) */
        .calc-large #calculator {
            width: 900px;
            height: 600px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 700px) {
            #securityConsole { display: none !important; } /* Hide console on small screens */
            #calculator { width: 95vw !important; height: 50vh !important; }
            #calculatorPopup { top: 10% !important; left: 2.5% !important; }
            .calc-large #calculator { width: 95vw !important; height: 70vh !important; }
        }
    </style>
</head>
<body>

    <div class="status-overlay" id="focusBar"></div>

    <!-- ================= SECURITY CONSOLE (Side Panel) ================= -->
    <div id="securityConsole">
        <!-- Clickable Header for Toggle -->
        <div class="console-header" onclick="toggleConsole()">
            <div class="console-title-group">
                <span>üîí Proctor Log</span>
                <div class="console-dot"></div>
            </div>
            <span class="console-toggle-icon" id="consoleIcon">‚àí</span>
        </div>
        <div id="consoleOutput">
            <!-- Logs appear here dynamically -->
        </div>
    </div>

    <!-- ================= WELCOME / PASSWORD SCREEN ================= -->
    <div class="container" id="welcomeScreen">
        <h1>Physics Brawl Tryouts</h1>
        <p><strong>Welcome!</strong> Please read the instructions below before beginning.</p>
        
        <div class="welcome-box">
            <h3>Test Structure</h3>
            <ul>
                <li><strong>Section 1 (Short Set):</strong> 4 Problems. Standard difficulty.</li>
                <li><strong>Section 2 (Challenge):</strong> 3 Problems (Optional but recommended). Covers Fluids, Dynamics, and Momentum.</li>
            </ul>
            
            <h3>Instructions</h3>
            <ul>
                <li><strong>Time Limit:</strong> Recommended 40‚Äì60 minutes.</li>
                <li><strong>Hints:</strong> Hints are available for every problem. Click "Show Hint" to see them.</li>
                <li><strong>Calculator:</strong> A graphing calculator is available (bottom right icon) once the test starts.</li>
                <li><strong>Anti-Cheat:</strong> Once you enter the password, the system will track if you switch tabs or leave the window.</li>
            </ul>
        </div>

        <div class="password-section">
            <label for="passwordInput">Enter Password to Start:</label>
            <input type="password" id="passwordInput" placeholder="Enter password here...">
            <button class="submit-btn" onclick="checkPassword()" style="margin-top: 15px;">START TRYOUTS</button>
            <div id="errorMsg" class="error-msg">Incorrect Password. Please try again.</div>
        </div>
    </div>

    <!-- ================= MAIN TEST CONTAINER (Hidden Initially) ================= -->
    <div class="container" id="testContainer" style="display: none;">
        <div class="header">
            <h1>Physics Brawl Tryouts</h1>
            <div class="warning">
                ‚ö†Ô∏è <strong>ANTI-CHEAT ACTIVE:</strong> Do not switch tabs or windows. 
                Your activity is being recorded in the side panel.
                <br>Use the built-in calculator to avoid triggering the anti-cheat.
            </div>
            <p>
                <strong>Rules:</strong> <br>
                1. Use \( g = 9.8 \, \text{m/s}^2 \), \( v_{\text{sound}} = 343 \, \text{m/s} \).<br>
                2. Show your reasoning/work in the text boxes.<br>
                3. Partial credit is better than no answer.
            </p>
        </div>

        <!-- FORM START -->
        <!-- REPLACE URL WITH YOUR FORMSPREE ID -->
        <form action="https://formspree.io/f/myzopqgk" method="POST" id="quizForm">
            
            <!-- Candidate Info -->
            <div class="problem" style="border-left-color: #333;">
                <h3>Candidate Information</h3>
                <label>Full Name</label>
                <input type="text" name="Full Name" required>
                <label>Email Address</label>
                <input type="email" name="Email" required>
            </div>

            <!-- ================= SECTION 1 ================= -->
            <div class="section-header">
                <h2>Section 1 ‚Äì Short Set</h2>
            </div>

            <!-- Problem 1 -->
            <div class="problem">
                <h3>Problem 1 ‚Äì Sound and the Sprint Start</h3>
                <p>
                    In a 100 m race, two sprinters run in lanes whose centers are separated sideways by <strong>3.66 m</strong>. The starter‚Äôs pistol is fired near lane 1. Assume:
                </p>
                <ul>
                    <li>Both sprinters start exactly when they <strong>hear</strong> the gun.</li>
                    <li>The speed of sound is \( 343 \, \text{m/s} \).</li>
                    <li>In the official result, Runner A finishes in <strong>9.784 s</strong>, Runner B in <strong>9.789 s</strong> (so A wins by <strong>0.005 s</strong>).</li>
                </ul>
                <p><strong>(a)</strong> If they instead had to react to the <strong>real gunshot</strong> (no speakers), by how much earlier would the closer runner hear the sound than the farther runner?</p>
                <label>Part (a) Answer:</label>
                <input type="text" name="P1_a_Answer" placeholder="e.g. 0.012 s">
                <p><strong>(b)</strong> Using that time advantage, which runner would win, and by roughly how much time, assuming their running speeds stay the same as in the original race?</p>
                <label>Part (b) Answer:</label>
                <input type="text" name="P1_b_Answer" placeholder="e.g. Runner A by 0.05 s">
                <label>Show your work / Reasoning:</label>
                <textarea name="P1_Work"></textarea>
                <div class="hint" onclick="toggleHint('h1')">Show Hint</div>
                <div id="h1" class="hint-content">
                    <ul>
                        <li>(a) Time difference = \( \Delta t = \frac{\Delta d}{v_{\text{sound}}} \), where \( \Delta d \) is 3.66 m.</li>
                        <li>(b) Think: if the closer runner <strong>hears earlier</strong>, they can start earlier. Compare that hearing-time difference to the original 0.005 s win margin.</li>
                    </ul>
                </div>
            </div>

            <!-- Problem 2 -->
            <div class="problem">
                <h3>Problem 2 ‚Äì Stressed Rail</h3>
                <p>
                    A long steel rail is held rigidly so that it <strong>cannot expand</strong>. Steel has:
                </p>
                <ul>
                    <li>Young‚Äôs modulus \( E = 195 \, \text{GPa} = 1.95 \times 10^{11} \, \text{Pa} \)</li>
                    <li>Linear expansion coefficient \( \alpha = 1.63 \times 10^{-5} \, \text{K}^{-1} \)</li>
                    <li>Maximum allowed stress in the rail \( \sigma_{\max} = 600 \, \text{MPa} = 6.0 \times 10^{8} \, \text{Pa} \)</li>
                </ul>
                <p>
                    If the temperature increases by \( \Delta T \), the rail ‚Äúwants‚Äù to expand, but the constraints prevent it, so stress builds up instead.
                </p>
                <p>
                    <strong>Question:</strong> What <strong>maximum temperature change</strong> \( \Delta T_{\max} \) (in K) can the rail withstand before the stress reaches \( \sigma_{\max} \)?
                </p>
                <label>Answer (Max Delta T in K):</label>
                <input type="text" name="P2_Answer">
                <label>Show your work:</label>
                <textarea name="P2_Work"></textarea>
                <div class="hint" onclick="toggleHint('h2')">Show Hint</div>
                <div id="h2" class="hint-content">
                    <ul>
                        <li>For free expansion: \( \frac{\Delta L}{L} = \alpha \Delta T \).</li>
                        <li>For elastic stretching: \( \sigma = E \varepsilon \), where \( \varepsilon = \frac{\Delta L}{L} \).</li>
                        <li>Combine: \( \sigma = E \alpha \Delta T \Rightarrow \Delta T = \frac{\sigma}{E \alpha} \).</li>
                    </ul>
                </div>
            </div>

            <!-- Problem 3 -->
            <div class="problem">
                <h3>Problem 3 ‚Äì Shadow Walking</h3>
                <p>
                    A street lamp is a point light source at height \( H = 3.2 \, \text{m} \). A person of height \( h = 1.8 \, \text{m} \) walks <strong>directly away</strong> from the lamp along flat ground at constant speed \( v = 1.5 \, \text{m/s} \).
                </p>
                <p>Let:</p>
                <ul>
                    <li>\( s(t) \) = horizontal distance from lamp to the person at time \( t \),</li>
                    <li>\( x(t) \) = length of the person‚Äôs shadow on the ground behind them,</li>
                    <li>The person starts at some initial distance \( s_0 \) at \( t = 0 \).</li>
                </ul>
                <p><strong>(a)</strong> Using similar triangles, express \( x \) in terms of \( s \), \( H \), and \( h \).</p>
                <p><strong>(b)</strong> Write \( s(t) \) and then \( x(t) \) explicitly as a function of \( t \).</p>
                <p><strong>(c)</strong> What is the <strong>acceleration</strong> of the tip of the shadow? (The tip is at distance \( s(t) + x(t) \) from the lamp.)</p>
                <label>Part (a) & (b) Expressions:</label>
                <textarea name="P3_Expressions" style="height: 60px;" placeholder="x = ... , s(t) = ..."></textarea>
                <label>Part (c) Acceleration Value:</label>
                <input type="text" name="P3_Acceleration">
                <label>Show your work:</label>
                <textarea name="P3_Work"></textarea>
                <div class="hint" onclick="toggleHint('h3')">Show Hint</div>
                <div id="h3" class="hint-content">
                    <ul>
                        <li>Draw the lamp, the person, and the shadow tip; you get two similar right triangles.</li>
                        <li>Ratio: \( \frac{s + x}{H} = \frac{x}{h} \). Solve for \( x \) in terms of \( s \).</li>
                        <li>The person moves at constant speed: \( s(t) = s_0 + vt \).</li>
                        <li>Look at the form of \( x(t) \): is it linear, quadratic, etc.? Then decide what the acceleration is.</li>
                    </ul>
                </div>
            </div>

            <!-- Problem 4 -->
            <div class="problem">
                <h3>Problem 4 ‚Äì Thumb-Rule Plane Spotting</h3>
                <p>
                    Martin looks out the window and sees a passenger plane crossing his field of view. He uses the rule:
                </p>
                <blockquote>
                    ‚Äú1 thumb at arm‚Äôs length = \( 2.5^\circ \) of angle.‚Äù
                </blockquote>
                <p>He estimates:</p>
                <ul>
                    <li>The plane stays in view for <strong>10 s</strong>.</li>
                    <li>During that time, it sweeps an angle of <strong>7.5 thumbs</strong> across the sky.</li>
                    <li>So the angular distance it travels is \( 7.5 \times 2.5^\circ \).</li>
                    <li>The plane itself appears about <strong>half a thumb</strong> long, and he guesses it‚Äôs a Boeing 737-800 of actual length \( 40 \, \text{m} \) (you may use 40 m).</li>
                </ul>
                <p>
                    Assume the plane flies in a straight line perpendicular to Martin‚Äôs line of sight (across his view).
                </p>
                <p>
                    <strong>Question:</strong> Estimate the plane‚Äôs <strong>speed in km/h</strong> based on these numbers.
                </p>
                <label>Answer (Speed in km/h):</label>
                <input type="text" name="P4_Answer">
                <label>Show your work:</label>
                <textarea name="P4_Work"></textarea>
                <div class="hint" onclick="toggleHint('h4')">Show Hint</div>
                <div id="h4" class="hint-content">
                    <ul>
                        <li>Convert thumbs ‚Üí degrees for total angular travel and angular size.</li>
                        <li>Treat ‚Äúangular size‚Äù like: \( \frac{\text{length of plane}}{\text{distance}} \approx \text{angular size in radians} \)</li>
                        <li>Then total path length \( \approx \frac{\text{angular travel}}{\text{angular size}} \times (\text{length of plane}) \).</li>
                        <li>Finally, \( v = \frac{\text{distance traveled}}{\text{time}} \), then convert m/s ‚Üí km/h by multiplying by 3.6.</li>
                    </ul>
                </div>
            </div>

            <!-- ================= SECTION 2 ================= -->
            <div class="section-header" style="background-color: #8e44ad;">
                <h2>Section 2 ‚Äì Optional Challenge</h2>
                <p style="margin:0; font-size: 0.9em;">Topics: Fluid Dynamics, Newton's Laws, Momentum</p>
            </div>

            <!-- Problem 5 -->
            <div class="problem section2">
                <h3>Problem 5 ‚Äì The Leaking Bottle (Fluids)</h3>
                <p>
                    A bottle of sparkling water falls and cracks when it hits the floor. A small hole opens up, and water spurts out at an angle of \( \alpha = 70^\circ \) (measured from the horizontal ground). The stream of water reaches a maximum vertical height of \( h = 1.20 \, \text{m} \) above the hole.
                </p>
                <p>
                    Assume the velocity of the water inside the bottle is negligible compared to the velocity at the hole. The density of water is \( \rho = 1000 \, \text{kg/m}^3 \).
                </p>
                <p>
                    <strong>Question:</strong> Calculate the gauge pressure inside the bottle (the difference \( \Delta p \) between the pressure inside the bottle and the atmospheric pressure outside) just as the water spurts out.
                </p>
                <label>Answer (Gauge Pressure in Pa):</label>
                <input type="text" name="P5_Answer">
                <label>Show your work:</label>
                <textarea name="P5_Work"></textarea>
                <div class="hint" onclick="toggleHint('h5')">Show Hint</div>
                <div id="h5" class="hint-content">
                    <ul>
                        <li><strong>Step 1 (Kinematics/Energy):</strong> Find the initial total velocity \( v \) of the water jet. You know the max height \( h \) depends on the vertical component of velocity \( v_y = v \sin \alpha \).</li>
                        <li><strong>Step 2 (Bernoulli):</strong> Use Bernoulli‚Äôs equation between the inside of the bottle (velocity \( \approx 0 \), pressure \( p \)) and the air just outside the hole (velocity \( v \), pressure \( p_{atm} \)).</li>
                        <li>\( p + \text{potential} = p_{atm} + \frac{1}{2}\rho v^2 \).</li>
                    </ul>
                </div>
            </div>

            <!-- Problem 6 -->
            <div class="problem section2">
                <h3>Problem 6 ‚Äì Pulleys and Friction (Dynamics)</h3>
                <p>
                    Consider a system of three identical blocks, each of mass \( m = 0.5 \, \text{kg} \).
                </p>
                <ul>
                    <li>Block A sits on top of Block B.</li>
                    <li>Block B sits on a horizontal table.</li>
                    <li>Block C hangs off the edge of the table.</li>
                </ul>
                <p>
                    The blocks are connected by massless ropes and massless, frictionless pulleys such that:
                </p>
                <ul>
                    <li>A rope pulls Block A to the left.</li>
                    <li>A rope pulls Block B to the right.</li>
                    <li>Both ropes eventually connect to the hanging Block C (meaning the weight of Block C drives the motion of A and B).</li>
                </ul>
                <p>
                    Because they are all connected by one continuous taut rope system, they all move with the same magnitude of acceleration \( |a| \). 
                    The coefficient of kinetic friction between all surfaces (between A and B, and between B and Table) is \( f = 0.10 \).
                </p>
                <p>
                    <strong>Question:</strong> Calculate the magnitude of the acceleration \( a \) of the blocks.
                </p>
                <p>
                    <em>(Note: Be careful with the friction on Block B‚Äîit has friction from the table below it AND friction from Block A above it!)</em>
                </p>
                <label>Answer (Acceleration in m/s¬≤):</label>
                <input type="text" name="P6_Answer">
                <label>Show your work:</label>
                <textarea name="P6_Work"></textarea>
                <div class="hint" onclick="toggleHint('h6')">Show Hint</div>
                <div id="h6" class="hint-content">
                    <ul>
                        <li>Draw Free Body Diagrams (FBD) for all three blocks.</li>
                        <li><strong>Block A:</strong> Is moving left. Friction opposes motion (acts right). Normal force comes from B.</li>
                        <li><strong>Block B:</strong> Is moving right. Friction from the table acts left. Friction from Block A (Newton‚Äôs 3rd law) also acts left. The Normal force from the table must support both A and B.</li>
                        <li><strong>Block C:</strong> Gravity acts down, Tension acts up.</li>
                        <li>Write \( F_{net} = ma \) for each and solve the system.</li>
                    </ul>
                </div>
            </div>

            <!-- Problem 7 -->
            <div class="problem section2">
                <h3>Problem 7 ‚Äì F1 Car on the Ceiling (Challenge)</h3>
                <p>
                    Formula 1 cars are designed with aerodynamic shapes (like an inverted wing) to push them down onto the track for better grip. Theoretically, if they go fast enough, they could drive upside down on a ceiling.
                </p>
                <p>
                    Model an F1 car as a right-angled triangular prism:
                </p>
                <ul>
                    <li>Length (base): \( d = 5.1 \, \text{m} \)</li>
                    <li>Height: \( h = 1.0 \, \text{m} \)</li>
                    <li>Width: \( w = 1.8 \, \text{m} \)</li>
                    <li>Total Mass: \( M = 800 \, \text{kg} \)</li>
                </ul>
                <p>
                    The car drives on the ceiling. Air particles (density \( \rho = 1.2 \, \text{kg/m}^3 \)) are stationary relative to the ceiling. The car hits them with velocity \( v \). Assume the air particles bounce elastically off the slanted surface of the car.
                </p>
                <p>
                    <strong>Question:</strong> Estimate the minimum speed \( v \) the car must travel so that the upward aerodynamic force from the bouncing air molecules balances the car's weight.
                </p>
                <label>Answer (Speed in m/s):</label>
                <input type="text" name="P7_Answer">
                <label>Show your work:</label>
                <textarea name="P7_Work"></textarea>
                <div class="hint" onclick="toggleHint('h7')">Show Hint</div>
                <div id="h7" class="hint-content">
                    <ul>
                        <li><strong>Geometry:</strong> Find the angle of the car's slope: \( \tan \alpha = h/d \).</li>
                        <li><strong>Momentum:</strong> In time \( \Delta t \), the car sweeps through a volume of air. Calculate the mass of that air.</li>
                        <li><strong>Collision:</strong> The particles hit the slope and bounce elastically. The angle of incidence equals the angle of reflection.</li>
                        <li>The change in momentum per unit time is the Force. You are looking for the <strong>vertical component</strong> of the force exerted by the air on the car.</li>
                        <li><strong>Equation:</strong> Set \( F_{vertical} = Mg \) and solve for \( v \).</li>
                    </ul>
                </div>
            </div>

            <!-- HIDDEN INPUTS FOR LOGS -->
            <input type="hidden" name="Focus_Log" id="focusLogInput">
            <input type="hidden" name="Total_Tabs_Switches" id="switchCountInput">
            <input type="hidden" name="Total_Time_Away_Seconds" id="timeAwayInput">

            <button type="submit" class="submit-btn" onclick="prepareSubmission(event)">Submit Answers</button>
        </form>
    </div>

    <!-- CALCULATOR ELEMENTS -->
    <button id="calcToggle" onclick="toggleCalculator()" title="Open Graphing Calculator">
        <!-- SVG Icon for Calculator -->
        <svg viewBox="0 0 24 24">
            <path d="M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V12H9V10H7M11,10V12H13V10H11M15,10V12H17V10H15M7,14V16H9V14H7M11,14V16H13V14H11M15,14V16H17V14H15M7,18V20H9V18H7M11,18V20H13V18H11M15,18V20H17V18H15Z" />
        </svg>
    </button>

    <div id="calculatorPopup">
        <div class="calc-header-bar" id="calcHeader">
            <span class="calc-title">Desmos Graphing Calculator</span>
            <div class="calc-controls">
                <button onclick="resizeCalculator()" title="Toggle Theater Mode">‚õ∂</button>
                <button onclick="toggleCalculator()" title="Close">‚úï</button>
            </div>
        </div>
        <div id="calculator"></div>
    </div>

    <script>
        // --- DESMOS CALCULATOR SETUP ---
        var elt = document.getElementById('calculator');
        var calculator = Desmos.GraphingCalculator(elt);

        // --- CALCULATOR UI LOGIC ---
        function toggleCalculator() {
            var popup = document.getElementById('calculatorPopup');
            var toggleBtn = document.getElementById('calcToggle');
            
            if (popup.style.display === "none" || popup.style.display === "") {
                popup.style.display = "block";
                toggleBtn.style.display = "none"; // Hide the FAB when calc is open
                calculator.resize(); // Ensure it renders correctly
            } else {
                popup.style.display = "none";
                toggleBtn.style.display = "flex"; // Show FAB when calc is closed
            }
        }

        function resizeCalculator() {
            var popup = document.getElementById('calculatorPopup');
            popup.classList.toggle('calc-large');
            // Desmos requires a resize call if the container dims change
            calculator.resize();
        }

        // --- DRAG FUNCTIONALITY ---
        dragElement(document.getElementById("calculatorPopup"));

        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            if (document.getElementById("calcHeader")) {
                document.getElementById("calcHeader").onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // --- HINT TOGGLE ---
        function toggleHint(id) {
            var x = document.getElementById(id);
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
        }

        // --- PASSWORD / START LOGIC ---
        let testStarted = false;

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('errorMsg');
            
            // Password check (Case Sensitive)
            if (input === "PPSCTRYOUTS") {
                // Success: Hide welcome, show test
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('testContainer').style.display = 'block';
                
                // Show UI Elements
                document.getElementById('calcToggle').style.display = 'flex';
                document.getElementById('securityConsole').style.display = 'block';
                
                // Initialize Anti-Cheat
                testStarted = true;
                startTime = new Date();
                recordEvent("TEST STARTED", "log-ok");

                // Refresh MathJax to ensure hidden equations render correctly
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }

            } else {
                // Fail
                errorMsg.style.display = 'block';
            }
        }

        // --- SECURITY CONSOLE TOGGLE ---
        function toggleConsole() {
            const consoleDiv = document.getElementById('securityConsole');
            const icon = document.getElementById('consoleIcon');
            
            consoleDiv.classList.toggle('minimized');
            
            if (consoleDiv.classList.contains('minimized')) {
                icon.innerText = "+";
            } else {
                icon.innerText = "‚àí";
            }
        }

        // --- ANTI-CHEAT LOGIC ---
        let switchCount = 0;
        let logData = [];
        let startTime = null; // Initialized only after password
        
        // Time tracking variables
        let totalTimeAway = 0; // in seconds
        let awayStartTime = null;

        function updateConsole(message, cssClass = "") {
            const consoleDiv = document.getElementById('consoleOutput');
            const time = new Date().toLocaleTimeString();
            
            const div = document.createElement('div');
            div.className = `log-entry ${cssClass}`;
            div.innerText = `[${time}] ${message}`;
            
            // Prepend to show newest at top
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function recordEvent(type, cssClass="") {
            if (!testStarted) return;

            let time = new Date();
            let timeDiff = Math.round((time - startTime) / 1000); 
            
            // Log to Array (for form submission)
            let entry = `[${time.toLocaleTimeString()}] ${type} (T+${timeDiff}s)`;
            logData.push(entry);
            
            // Log to Visible Console
            updateConsole(type, cssClass);
        }

        function startAwayTimer() {
            if (!testStarted) return;

            if (awayStartTime === null) {
                awayStartTime = new Date();
                document.getElementById('focusBar').classList.add('cheat-detected');
                document.title = "‚ö†Ô∏è COME BACK!";
            }
        }

        function stopAwayTimer() {
            if (!testStarted) return;

            if (awayStartTime !== null) {
                let now = new Date();
                let diff = (now - awayStartTime) / 1000; 
                totalTimeAway += diff;
                awayStartTime = null;
                document.title = "Physics Brawl Tryouts";
            }
        }

        // Detect Visibility Change (Switching Tabs/Minimizing)
        document.addEventListener("visibilitychange", function() {
            if (document.visibilityState === 'hidden') {
                if (testStarted) {
                    switchCount++;
                    recordEvent("TAB SWITCHED / HIDDEN", "log-warn");
                    startAwayTimer();
                }
            } else {
                if (testStarted) {
                    recordEvent("TAB RESTORED", "log-ok");
                    stopAwayTimer();
                }
            }
        });

        // Detect Window Blur (Clicking outside browser)
        window.addEventListener("blur", function() {
            if (document.visibilityState !== 'hidden') {
                if (testStarted) {
                    switchCount++;
                    recordEvent("WINDOW LOST FOCUS", "log-warn");
                    startAwayTimer();
                }
            }
        });

        window.addEventListener("focus", function() {
            if (testStarted) {
                stopAwayTimer();
            }
        });

        // --- PREPARE SUBMISSION ---
        function prepareSubmission(event) {
            const form = document.getElementById('quizForm');
            
            // 1. VALIDATION CHECK FIRST
            if (!form.checkValidity()) {
                // If form is invalid (e.g. bad email), return immediately.
                // This allows the browser to show its native error bubble
                // WITHOUT triggering the anti-cheat alert.
                // Note: We do NOT preventDefault here; we want the browser to try submitting so it triggers the UI.
                return;
            }

            // 2. STOP TIMERS & PREPARE DATA
            stopAwayTimer();

            // Populate hidden fields
            document.getElementById('focusLogInput').value = logData.join("\n");
            document.getElementById('switchCountInput').value = switchCount;
            document.getElementById('timeAwayInput').value = Math.round(totalTimeAway);
            
            // 3. SHOW ALERT (Only if valid)
            if(switchCount > 0) {
                alert("Submission Note: \nTabs Switched: " + switchCount + " times.\nTotal Time Away: " + Math.round(totalTimeAway) + " seconds.\nThis data will be sent to the organizer.");
            }
            
            // Function ends, allowing form submission to proceed
        }
    </script>
</body>
</html>
